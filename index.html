<script>
const API_URL = "https://literalistically-superuniversal-estell.ngrok-free.dev/api";

async function createRequest() {
    const user = document.getElementById("username").value.trim();
    if (!user) {
        alert("กรุณากรอกยูสเซอร์เนม");
        return;
    }

    const payload = {
        action: "create_request",
        secret: "yahari",
        username: user,
        baseAmount: 100
    };

    try {
        let response = await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        let data = await response.json();

        if (data.error) {
            alert("Error: " + data.error);
            return;
        }

        document.getElementById("result").style.display = "block";
        document.getElementById("result").innerHTML = `
            <b>ยอดที่ต้องโอน:</b> ${data.amount} บาท<br>
            <b>ข้อความบนสลิป:</b> ${data.id}<br><br>
            <b>โอนไปที่เบอร์:</b> 0922503869<br>
            <img src="https://promptpay.io/0922503869/${data.amount}.png" width="200">
        `;
    } catch (err) {
        alert("ระบบผิดพลาด: " + err.message);
    }
}
</script>
